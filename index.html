<!DOCTYPE html>
<html>
	<head>
		<title>Bricks Breaker</title>
		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<link rel="stylesheet" href="TemplateData/style.css">
		<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
	</head>
<body>
  <div class="wrap">
    <div class="add-btn">
      <div class="plus"></div>
      <div class="text">
        <span class="add-text" onclick="vkBridge.send('VKWebAppShowInviteBox', {});">Добавить</span> друзей
      </div>
    </div> 
  </div>

	<div id="gameContainer">
		<canvas id="unity-canvas"></canvas>

		<div id="unity-loading-bar">
		<div id="unity-logo"></div>
			<div id="unity-progress-bar-empty">
				<div id="unity-progress-bar-full"></div>
			</div>
		</div>
	</div>

  <script>
    // vk SDK
    var vkBridgeInit = false;
    vkBridge.send('VKWebAppInit');
    vkBridge.send("VKWebAppShowNativeAds", { ad_format:"interstitial" });

    function showFullscrenAd() {
      if(vkBridgeInit){
        vkBridge.send("VKWebAppShowNativeAds", { ad_format:"interstitial" });
      }else {
        vkBridgeInit = true;
      }
    }
  </script>
	<script src="Build/dist.loader.js"></script>
	<script>
		var body = document.querySelector("body");
		var gameContainer = document.querySelector('#gameContainer');
		var gameCanvas = document.querySelector('#unity-canvas');
		var canvas = document.querySelector("#unity-canvas");
		var loadingBar = document.querySelector("#unity-loading-bar");
		var progressBarFull = document.querySelector("#unity-progress-bar-full");

		loadingBar.style.display = "block";

		var config = {
        dataUrl: "Build/dist.data",
        frameworkUrl: "Build/dist.framework.js",
        codeUrl: "Build/dist.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Games404",
        productName: "TempleEscape",
        productVersion: "0.0.1"
		};

		var scaleToFit;
		try {
			scaleToFit = !!JSON.parse("");
		} catch (e) {
			scaleToFit = true;
		}
		function progressHandler(progress) {
			progressBarFull.style.width = 100 * progress + "%";
		}
		function onResize() {
			var container = canvas.parentElement;
			var w;
			var h;

			if(scaleToFit){
				w = window.innerWidth;
				if(window.innerWidth > 991){
					h = window.innerHeight;
				}else {
					h = window.innerHeight - 90;
				}

				var r = 640 / 1136;

				if (w * r > window.innerHeight) {
					w = Math.min(w, Math.ceil(h / r));
				}
				h = Math.floor(w * r);
			}else {
				w = 1136;
				h = 640;
			}

			if(window.innerWidth > 991){
				container.style.width = canvas.style.width = w + "px";
				container.style.height = canvas.style.height = h + "px";
				container.style.top = Math.floor((window.innerHeight - h) / 2) + "px";
				container.style.left = Math.floor((window.innerWidth - w) / 2) + "px";
			}else {
				container.style.width = "100%";
				container.style.height = "100%";
				container.style.top = "0";
				container.style.left = "0";

				canvas.style.width = w + "px";
				canvas.style.height = h + "px";
				rtb_mobile.style.height = (window.innerHeight - canvas.offsetHeight) + "px";

				gameContainer.focus();
				window.focus();
				gameCanvas.focus();
			}
		}
		createUnityInstance(canvas, config, progressHandler).then(function (instance) {
			window.unityInstance = instance;
			canvas = instance.Module.canvas;
			loadingBar.style.display = "none";
			onResize();
		});
		window.addEventListener('resize', onResize);
		onResize();


		// focus
		window.addEventListener('touchstart', function(evt) {
			gameContainer.focus();
			window.focus();
			gameCanvas.focus();
		}, false);

		window.addEventListener('pointerdown', function(evt) {
			gameContainer.focus();
			window.focus();
			gameCanvas.focus();
		}, false);
	</script>
</body>
</html>
